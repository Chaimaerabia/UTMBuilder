
      function generateUTMUrl() {
    document.getElementById("error-message").textContent = "";  // Clear previous error message

    var purpose = document.getElementById("purpose").value;
    var agency = document.getElementById("agency").value;
    var source = document.getElementById("source").value;
    var testChecked = document.getElementById("test-checkbox").checked;

    // Validate that source is selected
    if (!source) {
        document.getElementById("error-message").textContent = "Please select a lead source.";
        return;
    }

    // Base URL
    var baseUrl = purpose === "SCHEDULE" ? "https://iqostest.com/schedule?" : "https://iqostest.com/?";

    // Initialize URL components
    var utm_source = "";
    var utm_campaign = "";

    // Define source and campaign based on the selected source
    switch (source) {
        case "CRM":
            utm_source = "crm";
            break;
        case "CRM-AOKI-TEASER":
            utm_source = "crm";
            utm_campaign = "aoki";
            break;
        case "SMM":
            utm_source = "social";
            break;
        case "SMM-AOKI-TEASER":
            utm_source = "social";
            utm_campaign = "aoki";
            break;
        case "SMMBIO":
            utm_source = "social";
            break;
        case "SMMHIGH":
            utm_source = "social";
            break;
        case "WEB":
            utm_source = "web";
            break;
        case "WEB-AOKI":
            utm_source = "web";
            utm_campaign = "aoki";
            break;
        case "WEB-AOKI-TEASER":
            utm_source = "web";
            utm_campaign = "aoki";
            break;
        case "COIN":
            utm_source = "coin_mechanic";
            break;
        case "ADS_IAB":
            utm_source = "ads_iab";
            utm_campaign = "avito";
            break;
        case "GLOVO":
            utm_source = "glovo";
            utm_campaign = "coin_mechanic";
            break;
        case "SHOP":
            utm_source = "shop";
            utm_campaign = "avito";
            break;
        case "SHOP_WSP":
            utm_source = "shop_wsp";
            break;
        case "SHOP_CALL":
            utm_source = "shop_call";
            break;
        default:
            utm_source = source;
            break;
    }

    // If TEST is checked, append "-TEST" to lead source
    if (testChecked) {
        source += "-TEST";
        if (utm_source) {
            utm_source += "-TEST";
        }
        if (utm_campaign) {
            utm_campaign += "-TEST";
        }
    }

    // Prepare UTM URL
    var utmUrl = baseUrl + "agency=" + agency + "&source=" + source;
    if (utm_source) utmUrl += "&utm_source=" + utm_source;
    if (utm_campaign) utmUrl += "&utm_campaign=" + utm_campaign;

    // Display the generated URL
    document.getElementById("utm-url").value = utmUrl;
}
